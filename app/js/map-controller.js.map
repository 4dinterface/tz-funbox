{"version":3,"sources":["../../src/map-controller.js"],"names":[],"mappings":"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","file":"map-controller.js","sourcesContent":["'use strict';\r\nvar app = angular.module('phonecatApp', ['mapComponent']);\r\n\r\napp.controller('PhoneListCtrl', function($scope, $element) {\r\n  var drag,\r\n    placeholder,\r\n    targetPos,//позиция элемента для вставки    \r\n    offsetY,\r\n    children,\r\n    $document = angular.element(document);\r\n\r\n  $scope.wayPoints = [];\r\n  \r\n  $scope.modePath=true;\r\n  \r\n  //контролёр сам определит как вести себя если возникли проблемы с маршрутом\r\n  $scope.$on(\"badRoute\",()=>{\r\n    alert(123123);\r\n    angular.element(\"#errorpanel\").show();\r\n  })  \r\n\r\n  $scope.keyDown = function($event) {\r\n    if ($event.keyCode != 13) return;\r\n    $scope.wayPoints.push({address:$event.target.value})\r\n    $event.target.value = \"\"\r\n  };\r\n\r\n  $scope.remove = function(index,$event) {\r\n    $scope.wayPoints.splice(index, 1)\r\n    $event.stopPropagation();\r\n  };\r\n\r\n  $scope.mouseDown=function(e) {\r\n    var rect;    \r\n    drag = e.target.tagName==\"LI\"?angular.element(e.target):angular.element(e.target).parent();\r\n    rect = drag[0].getBoundingClientRect();\r\n\r\n    if (placeholder) placeholder.remove();\r\n    placeholder = angular.element(drag).clone();\r\n    placeholder.css(\"opacity\", 0);\r\n    drag[0].parentNode.insertBefore(placeholder[0], drag[0])\r\n\r\n    drag.css({\r\n      \"position\": \"absolute\",\r\n      \"left\": rect.left + \"px\",\r\n      \"top\": rect.top + \"px\",\r\n      \"width\": rect.width + \"px\",\r\n      \"height\": rect.height + \"px\",\r\n      \"z-index\": 1,\r\n      \"cursor\": \"move\"      \r\n    })\r\n\r\n    drag.css(\"user-select\", \"none\");\r\n    offsetY = rect.top - e.clientY;\r\n\r\n    children = getChildren(drag);\r\n    $element.on(\"mousemove\", onMouseMove);\r\n    $document.on(\"mouseup\", onMouseUp);    \r\n  };\r\n\r\n  function onMouseUp(e) {\r\n    $element.off(\"mousemove\", onMouseMove);\r\n    $document.off(\"mouseup\", onMouseUp);        \r\n    if(!drag) return;    \r\n    \r\n    drag.css({\r\n      \"position\":\"relative\",\r\n      \"left\":0,\r\n      \"top\":0,\r\n      \"height\":\"\",\r\n      \"width\":\"\",\r\n      \"z-index\":\"\",\r\n      \"cursor\":\"auto\" \r\n    })\r\n    \r\n    placeholder.remove();\r\n    $scope.$apply(() => {\r\n      var srcPos = Number(drag.attr(\"index\")),\r\n          removePos=srcPos>targetPos?srcPos+1:srcPos;\r\n      $scope.wayPoints.splice(targetPos, 0, $scope.wayPoints[srcPos]);\r\n      $scope.wayPoints.splice(removePos, 1);\r\n    });\r\n\r\n    placeholder = null;\r\n    drag = null;\r\n  };\r\n\r\n  function onMouseMove(e) {\r\n    var posY = e.clientY, //drag.position().top+drag.height()/2,\r\n        target = children.find((el) => el.rect.top < posY && el.rect.top + el.rect.height > posY),\r\n        i = children.length - 1,\r\n        el;\r\n\r\n    drag.css(\"top\", (e.clientY + offsetY) + \"px\");\r\n\r\n    if (!target || target.el == placeholder[0]) return;\r\n\r\n    if (target.rect.top + (target.rect.height / 2) < e.clientY){\r\n      target.el.parentNode.insertBefore(placeholder[0], target.el)\r\n      targetPos=Number(target.el.getAttribute(\"index\"))\r\n    } else {\r\n      target.el.nextSibling.parentNode.insertBefore(placeholder[0], target.el.nextSibling)\r\n      targetPos=Number(target.el.getAttribute(\"index\"))+1\r\n    }\r\n    \r\n    children = getChildren(drag); //массив children обновляется лишь тогда когда имело место перестановка\r\n  };  \r\n\r\n  function getChildren(drag) {\r\n    var arr = [],\r\n        children = $element.find(\"ul\").children(\"li\");\r\n    \r\n    for (let i = 0; i < children.length; i++)\r\n      if (drag[0] !== children[i]) arr.push({\r\n        el: children[i],\r\n        rect: children[i].getBoundingClientRect()\r\n      });\r\n\r\n    return arr;\r\n  } \r\n  \r\n});"]}