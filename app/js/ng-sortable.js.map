{"version":3,"sources":["../../src/ng-sortable.js"],"names":[],"mappings":"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","file":"ng-sortable.js","sourcesContent":["\"use strict\"\r\n\r\nclass NgSortable {\r\n\r\n  /** смещение по клику мыши + позиция контейнера **/\r\n  offsetY;\r\n\r\n  /** $scope **/\r\n  $scope;\r\n\r\n  /** element на котором висит деректива **/\r\n  element;\r\n\r\n  /** перетаскиваемый элемент **/\r\n  ddElement;\r\n\r\n  /** указывает место куда вставляется обьект **/\r\n  placeholder;\r\n\r\n  /** список все дум элементов участвующих в сортировке **/\r\n  items;\r\n\r\n  /** координаты контейнера для перетасквамых элементов **/\r\n  parentRect;\r\n\r\n  /** позиция в массиве куда происходит установка gперемещаемого элемента**/\r\n  insertPos;\r\n\r\n  /**\r\n   * конструктор\r\n   * вызывается фабрикой в момент создания экземпляра компонента\r\n   * @param ...args -зависимости\r\n   */\r\n  constructor() {\r\n    this.scope = {\r\n      ngSortable: \"=\",\r\n    }\r\n    this.onMouseMove = this.onMouseMove.bind(this);\r\n    this.onMouseUp = this.onMouseUp.bind(this);\r\n    this.document = angular.element(document);\r\n    this.controllerAs=\"sortableController\";\r\n  }\r\n\r\n  /**\r\n   * системный callback\r\n   * здеь инициалиируется приватный api компонента\r\n   *\r\n   * @param $scope\r\n   * @param element\r\n   * @param attr   \r\n   */\r\n  link($scope, element, attr) {\r\n    this.$scope = $scope;\r\n    this.element = element;\r\n    element.on(\"mousedown\", this.onMouseDown.bind(this));    \r\n    console.log(\"zzzz\",angular.expando .expando,element.data);\r\n  }\r\n  \r\n  \r\n  \r\n  /**\r\n   * контроллёр директивы\r\n   * здесь опишем внешний api копонента \r\n   * @param $scope\r\n   * @param element\r\n   * @param attr  \r\n   */\r\n  controller(privateAPI, $scope, element){\r\n    this.rrr=100;\r\n  }\r\n    \r\n  \r\n  /**\r\n   * создаёт placeholder\r\n   * @param rect\r\n   */\r\n  initPlaceHolder(rect){\r\n    if (this.placeholder) this.placeholder.remove();\r\n    this.placeholder = this.ddElement.clone();\r\n    this.placeholder.css(\"opacity\", 0);\r\n\r\n    this.ddElement.css({\r\n      \"position\": \"absolute\",\r\n      \"left\": rect.left + \"px\",\r\n      \"top\": rect.top - this.parentRect.top + \"px\",\r\n      \"width\": rect.width + \"px\",\r\n      \"height\": rect.height + \"px\",\r\n      \"z-index\": 1,\r\n      \"cursor\": \"move\"\r\n    })    \r\n    \r\n    this.ddElement.before(this.placeholder); //this.ddElement[0].parentNode.insertBefore(this.placeholder[0], this.ddElement[0])\r\n    return this.placeholder;\r\n  }\r\n    \r\n\r\n  /**\r\n   * обработчик mousedown на элементе подлежащим перемещению\r\n   * @param e\r\n   */\r\n  onMouseDown(e) {\r\n    var rect;\r\n    this.ddElement = e.target.tagName == \"LI\" ? angular.element(e.target) : angular.element(e.target).closest(\"LI\", this.element);\r\n    if (!this.ddElement) return;\r\n\r\n    this.parentRect = this.ddElement.parent()[0].getBoundingClientRect();\r\n    rect = this.ddElement[0].getBoundingClientRect();\r\n    \r\n    this.offsetY = (rect.top - e.clientY) - this.parentRect.top;\r\n    \r\n    this.initPlaceHolder(rect);\r\n    \r\n    this.items = this.getChildren(this.ddElement);\r\n    this.document.on(\"mousemove\", this.onMouseMove);\r\n    this.document.on(\"mouseup\", this.onMouseUp);\r\n  };\r\n\r\n  /**\r\n   * обработчик mousedown на document\r\n   * @param e\r\n   */\r\n  onMouseUp(e) {\r\n    this.document.off(\"mousemove\", this.onMouseMove);\r\n    this.document.off(\"mouseup\", this.onMouseUp);\r\n    if (!this.ddElement) return;\r\n\r\n    this.ddElement.css({\r\n      \"position\": \"relative\",\r\n      \"left\": 0,\r\n      \"top\": 0,\r\n      \"height\": \"\",\r\n      \"width\": \"\",\r\n      \"z-index\": \"\",\r\n      \"cursor\": \"auto\"\r\n    })\r\n\r\n    this.placeholder.remove();\r\n    this.$scope.$apply(() => {\r\n      var srcPos = Number(this.ddElement.attr(\"index\")),\r\n        removePos = srcPos > this.insertPos ? srcPos + 1 : srcPos;\r\n\r\n      this.$scope.ngSortable.splice(this.insertPos, 0, this.$scope.ngSortable[srcPos]);\r\n      this.$scope.ngSortable.splice(removePos, 1);\r\n    });\r\n\r\n    this.placeholder = null;\r\n    this.ddElement = null;\r\n  };\r\n\r\n  /**\r\n   * обработчик mousemove на document\r\n   * @param e\r\n   */\r\n  onMouseMove(e) {\r\n    if(!this.items) return;\r\n    \r\n    var posY = e.clientY, //this.ddElement.position().top+this.ddElement.height()/2,\r\n      target = this.items.find((el) => el.rect.top < posY && el.rect.top + el.rect.height > posY),\r\n      i = this.items.length - 1,\r\n      el;\r\n\r\n    this.ddElement.css(\"top\", (e.clientY + this.offsetY) + \"px\");\r\n\r\n    if (!target || target.el == this.placeholder[0]) return;\r\n\r\n    if (target.rect.top + (target.rect.height / 2) < e.clientY) {\r\n      target.el.parentNode.insertBefore(this.placeholder[0], target.el)\r\n      this.insertPos = Number(target.el.getAttribute(\"index\"))\r\n    } else {\r\n      target.el.nextSibling.parentNode.insertBefore(this.placeholder[0], target.el.nextSibling)\r\n      this.insertPos = Number(target.el.getAttribute(\"index\")) + 1\r\n    }\r\n\r\n    this.items = this.getChildren(this.ddElement); //массив children обновляется лишь тогда когда имело место перестановка\r\n  };\r\n\r\n  /**\r\n   * возвращает все dom элементы подлежащие перетаскиванию\r\n   * @param e\r\n   */\r\n  getChildren(item) {\r\n    var arr = [],\r\n      children = this.element.children(\"li\");\r\n\r\n    for (let i = 0; i < children.length; i++)\r\n      if (item[0] !== children[i]) arr.push({\r\n        el: children[i],\r\n        rect: children[i].getBoundingClientRect()\r\n      });\r\n\r\n    return arr;\r\n  }\r\n\r\n  /**\r\n   * обработчик mousemove на document\r\n   * @param ...args - зависимости\r\n   * @returns {NgSortable}\r\n   */\r\n  static factory(...args) {\r\n    var instance = new NgSortable(...args);\r\n    instance.link = NgSortable.prototype.link ? NgSortable.prototype.link.bind(instance) : instance.link;\r\n    \r\n    var controller=instance.controller;\r\n    instance.controller=['$scope', '$element', function($scope, $element){\r\n      return new controller(instance, $scope, $element);\r\n    }]\r\n    return instance;\r\n  }\r\n}\r\n\r\nNgSortable.factory.$inject = [];\r\nangular.module(\"ngSortable\", []).directive(\"ngSortable\", NgSortable.factory);"]}